/*!
	Slimbox v2.05 - The ultimate lightweight Lightbox clone for jQuery
	(c) 2007-2013 Christophe Beyls <http://www.digitalia.be>
	MIT-style license.
	* 
	* Customized by rockyhorror for pluxml: add a download link, allow script to limit image size
	* 
*/

!function(i){function e(){var e=N.width,t=N.height;if(e>u.maxWidth){var n=u.maxWidth,o=e/u.maxWidth,a=t/o;return i(z).css({backgroundSize:n}),[n,a]}if(t>u.maxHeight){var a=u.maxHeight,o=t/u.maxHeight,n=e/o;return i(z).css({backgroundSize:n}),[n,a]}return i(z).css({backgroundSize:""}),[e,t]}function t(){var e=K.scrollLeft(),t=K.width();i([k,L]).css("left",e+t/2),y&&i(x).css({left:e,top:K.scrollTop(),width:t,height:K.height()})}function n(e){e?i("object").add(C?"select":"embed").each(function(i,e){E[i]=[e,e.style.visibility],e.style.visibility="hidden"}):(i.each(E,function(i,e){e[0].style.visibility=e[1]}),E=[]);var n=e?"bind":"unbind";K[n]("scroll resize",t),i(document)[n]("keydown",o)}function o(e){var t=e.which,n=i.inArray;return n(t,u.closeKeys)>=0?h():n(t,u.nextKeys)>=0?r():n(t,u.previousKeys)>=0?a():null}function a(){return l(p)}function r(){return l(m)}function l(i){return i>=0&&(F=i,g=f[F][0],p=(F||(u.loop?f.length:0))-1,m=(F+1)%f.length||(u.loop?0:-1),c(),k.className="lbLoading",N=new Image,N.onload=s,N.src=g),!1}function s(){k.className="",i(z).css({backgroundImage:"url("+g+")",visibility:"hidden",display:""}),imgSize=e(),i(D).width(imgSize[0]),i([D,T,H]).height(imgSize[1]),i(S).html(f[F][1]||""),i(W).html((f.length>1&&u.counterText||"").replace(/{x}/,F+1).replace(/{y}/,f.length)),u.downloadText&&(i(link).html(u.downloadText),i(link).attr("href",g)),p>=0&&(O.src=f[p][0]),m>=0&&(A.src=f[m][0]),b=z.offsetWidth,w=z.offsetHeight;var t=Math.max(0,v-w/2);k.offsetHeight!=w&&i(k).animate({height:w,top:t},u.resizeDuration,u.resizeEasing),k.offsetWidth!=b&&i(k).animate({width:b,marginLeft:-b/2},u.resizeDuration,u.resizeEasing),i(k).queue(function(){i(L).css({width:b,top:t+w,marginLeft:-b/2,visibility:"hidden",display:""}),i(z).css({display:"none",visibility:"",opacity:""}).fadeIn(u.imageFadeDuration,d)})}function d(){p>=0&&i(T).show(),m>=0&&i(H).show(),i(I).css("marginTop",-I.offsetHeight).animate({marginTop:0},u.captionAnimationDuration),L.style.visibility=""}function c(){N.onload=null,N.src=O.src=A.src=g,i([k,z,I]).stop(!0),i([T,H,z,L]).hide()}function h(){return F>=0&&(c(),F=p=m=-1,i(k).hide(),i(x).stop().fadeOut(u.overlayFadeDuration,n)),!1}var u,f,g,p,m,y,v,b,w,x,k,z,D,T,H,L,I,S,W,K=i(window),F=-1,C=!window.XMLHttpRequest,E=[],N=(document.documentElement,{}),O=new Image,A=new Image;i(function(){i("body").append(i([x=i('<div id="lbOverlay" />').click(h)[0],k=i('<div id="lbCenter" />')[0],L=i('<div id="lbBottomContainer" />')[0]]).css("display","none")),z=i('<div id="lbImage" />').appendTo(k).append(D=i('<div style="position: relative;" />').append([T=i('<a id="lbPrevLink" href="#" />').click(a)[0],H=i('<a id="lbNextLink" href="#" />').click(r)[0]])[0])[0],I=i('<div id="lbBottom" />').appendTo(L).append([i('<a id="lbCloseLink" href="#" />').click(h)[0],S=i('<div id="lbCaption" />')[0],W=i('<div id="lbNumber" />')[0],link=i('<a id="lbDownload" onclick="window.open(this.href);return false;" href="#" />')[0],i('<div style="clear: both;" />')[0]])[0]}),i.slimbox=function(e,o,a){return u=i.extend({loop:!1,overlayOpacity:.8,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initialHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"Image {x} of {y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78],downloadText:"Download",maxWidth:800,maxHeight:600},a),"string"==typeof e&&(e=[[e,o]],o=0),v=K.scrollTop()+K.height()/2,b=u.initialWidth,w=u.initialHeight,i(k).css({top:Math.max(0,v-w/2),width:b,height:w,marginLeft:-b/2}).show(),y=C||x.currentStyle&&"fixed"!=x.currentStyle.position,y&&(x.style.position="absolute"),i(x).css("opacity",u.overlayOpacity).fadeIn(u.overlayFadeDuration),t(),n(1),f=e,u.loop=u.loop&&f.length>1,l(o)},i.fn.slimbox=function(e,t,n){t=t||function(i){return[i.href,i.title]},n=n||function(){return!0};var o=this;return o.unbind("click").click(function(){var a,r,l=this,s=0,d=0;for(a=i.grep(o,function(i,e){return n.call(l,i,e)}),r=a.length;r>d;++d)a[d]==l&&(s=d),a[d]=t(a[d],d);return i.slimbox(a,s,e)})}}(jQuery);

// AUTOLOAD CODE BLOCK (MAY BE CHANGED OR REMOVED)
if (!/android|iphone|ipod|series60|symbian|windows ce|blackberry/i.test(navigator.userAgent)) {
	jQuery(function($) {
		$("a[rel^='artgalerie']").slimbox({counterText: "Image {x} sur {y}", downloadText: "Télécharger"}, null, function(el) {
			return (this == el) || ((this.rel.length > 8) && (this.rel == el.rel));
		});
	});
}
